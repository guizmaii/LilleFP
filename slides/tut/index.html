<!DOCTYPE html>
<html>
<head>
    <title>Pure FP ?</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif', 'Helvetica'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz', 'Gill Sans';
        font-weight: normal;
      }
      table {
        border-collapse: collapse;
      }
      th, td {
        padding: 30px;
        border: 1px solid black;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono', 'Consolas', 'Courier New'; }
      .red { color: red; }
      .bold { font-weight: bold; }
      .center {
        text-align: center;
        margin-left: 5%;
        margin-right: 5%;
      }
      .small { font-size: small; }
    </style>
</head>
<body>
<div id="source">


class: center, middle

# Pure FP ?

 ü§î

### A journey from imperative OO to pure functional programming

Jules Ivanic ‚Ä¢ `@guizmaii`

???
- notes here
- see https://remarkjs.com/#1

---

# Who am I ?

## Jules Ivanic

 - 30 ans

 - Professional developer since 5 years.

 - Mostly Scala/FP developer today

 - Ex-CTO @ Colisweb .small[(Ils recrutent: https://www.welcometothejungle.co/fr/companies/colisweb)]

 - Passionate surfer since I'm 11. Leaving to Australia in June üåäüèÑ

???
Empty
---
# Summary

 1. Disclaimer

 2. Functional programming ?

 3. Impure FP ?

 4. Pure FP ?

 5. Conlusion

 6. Questions

---
# 1. Disclaimer

<br />
<br />
<br />

.center[

![Image](jdg_wisdom.png)

]

???
Apprendre est un processus personnel. Je ne peux rien vous apprendre.
Je peux vous montrer, vous expliquer mais la compr√©hension de ce que je vous montre/explique se passe dans votre t√™te.

Apprendre demande du travail personnel. Vous n'apprenez pas juste en regardant un talk.

Sur des sujets non triviaux, il faut que vous gagner votre propre "intuition".
C'est cette intuition qui vous permet de comprendre les choses complexes.

Je peux vous partager mon intuition, plus quelques autres si j'en connais d'autres.
Si une de ces intuitions vous parle, cool. Cela va vous permettre de comprendre.
Sinon, il va falloir que vous travailliez pour r√©ussir √† trouver votre propre intuition.
Ce processus peut-√™tre long. Cela d√©pend de plein de param√™tres: du sujet, de votre proximit√© avec celui-ci, etc.

Pour moi, cette notion d'"intuition" est essentiel, c'est pourquoi je tenais √† prendre ces deux minutes pour vous en parler.
---
# Imperative OO

```java
// I used to write things like that...

class Person {

  private String name;
  private Int age;
  private String address;

  public Person(String name, Int age, String address) {

    if (age < 0 || age > 120) {
      throw new RuntimeException("age is invalid");
    }

    this.name = name; this.age = age; this.address = address;
  }

  public String getName {
    return this.name;
  }

  public void setName(String name) {
    this.name = name;
  }

  ...
}
```
---
# (Synchronous) Imperative OO

```java
// I used to write things like that...

class PersonRepo {

  private DB dbInstance;

  public PersonRepo(DB dbInstance) {
    this.dbInstance = dbInstance;
  }

  public void savePerson(Person p, GpsPoint point) {
    dbInstance.query(
      "INSERT INTO PERSONS (name, age, address, gpsPoint) VALUES (?, ?, ?, ?)",
      p.name, p.age, p.address, point
    )
  }
}

// Or even worst... ü§¢

class PersonRepoSpring {

  @Inject
  private DB instance;

  ...
}
```
---
# (Synchronous) Imperative OO

```java
// I used to write things like that...

class GoogleService {

  private final SyncHttpClient httpClient;

  public GoogleService(SyncHttpClient httpClient) {
    this.httpClient = httpClient;
  }

  public GpsPoint geocode(String address) {
    String res =
      httpClient
        .get("https://api.google.com/geocode/address")
        .body("{ \"address\": \"" + address + "\" }")
        .execute();

    parse(res);
  }
}
```
---
# (Synchronous) Imperative OO

```java
class Server extends FrameworkMagic {

  private final GoogleService geocoder;
  private final PersonRepo    repo;

  /**
    * Accepted JSON requests:
    *
    * { "name": "Jules", "age": 30, "address": "Sydney, Australia" }
    */
  @Put("/person")
  public HttpResponse createPerson(@Body Person person) {
    // TODO: Your mission, if you accept, is to code this method.
  }

}
```
---
# (Synchronous) Imperative OO

```java
@Put("/person")
public HttpResponse createPerson(@Body Person person) {

  GpsPoint point = geocoder.geocode(person.address);

  repo.savePerson(person, point);

  return HttpResponse.Created("Done üëç");
}
```
---
# (Synchronous) Imperative OO

```java
@Put("/person")
public HttpResponse createPerson(@Body Person person) {

  GpsPoint point = geocoder.geocode(person.address);

  repo.savePerson(person, point);

  return HttpResponse.Created("Done üëç");
}
```

<br />

.bold[Your nice ignorant boss ü§¥ :]  Nice work. Here's your üíµ

.bold[Me (your CTO) üë®‚Äçüè´ :] You're fired. You waste our money.
---
# (Synchronous) Imperative OO

```java
@Put("/person")
public HttpResponse createPerson(@Body Person person) {

  GpsPoint point = geocoder.geocode(person.address);

  repo.savePerson(person, point);

  return HttpResponse.Created("Done üëç");
}
```

<br />

Problems in this code:
  - No error handling
  - Synchronous
  - Uncontrolled side effects
  - mutable
---
# (Synchronous) Imperative OO

```java
@Put("/person")
public HttpResponse createPerson(@Body Person person) {

  GpsPoint point = geocoder.geocode(person.address);

  repo.savePerson(person, point);

  return HttpResponse.Created("Done üëç");
}
```

<br />

.bold[
Let's improve that piece of code!
]

We'll make it asynchronous and we'll handle errors in the same time

Thanks to ???
---
# [A]synchronous, [non-]blocking ? ü§î

<br />

.center[
|                     | Synchronous                          | Asynchronous                  |
|---------------------|--------------------------------------|-------------------------------|
| .bold[blocking]     | Waste LOTS OF CPU resources          | Unsafe, waste resources       |
| .bold[non-blocking] | Non sensical                         | Holy graal üèÜ                 |
]

<br />

[Latency numbers every programmer should know](https://gist.github.com/guizmaii/6395ad8abf1b1718f4a3128fec81f7ce)
---
# Impure FP

First, let's rewrite the `Person` class ...

```java
class Person {

  private String name;
  private Int age;
  private String address;

  public Person(String name, Int age, String address) {

    if (age < 0 || age > 120) {
      throw new RuntimeException("age is invalid");
    }

    this.name = name; this.age = age; this.address = address;
  }

  public String getName {
    return this.name;
  }

  public void setName(String name) {
    this.name = name;
  }

  ...
}
```
---
# Impure FP

... in Scala

```tut:silent
case class Person(name: String, age: Int, address: String)
```
---
# Impure FP

... in .bold[Scala]

```tut:silent
case class Person(name: String, age: Int, address: String)
```

<br />

.bold[BOOOMM] ü§©
---
# Impure FP

... in .bold[Scala]

```tut:silent
case class Person(name: String, age: Int, address: String)
```

<br />

.bold[BOOOMM] ü§©

But why choose Scala ? Why not stay with Java ?

And also, is this code really equivalent to the previous Java one ?
---
# Impure FP

```tut:silent
case class Person(name: String, age: Int, address: String)

object Person {

  def apply(name: String, age: Int, address: String): Person =
    if (age < 0 || age > 120) throw new RuntimeException("age is invalid")
    else                      new Person(name, age, address)

}

// Usage example:

val jules = Person("Jules", 30, "Sydney, Australia")
```

<br />

Now, it's equivalent to the Java code.
---
# Impure FP

```tut:silent
case class Person(name: String, age: Int, address: String)

object Person {

  def apply(name: String, age: Int, address: String): Person =
    if (age < 0 || age > 120) throw new RuntimeException("age is invalid")
    else                      new Person(name, age, address)

}

// Usage example:

val jules = Person("Jules", 30, "Sydney, Australia")
```

<br />

Now, it's equivalent to the Java code.

.bold[Except that it's immutable] ü§©
---
# Impure FP

```tut:silent
case class Person(name: String, age: Int, address: String)

object Person {

  def apply(name: String, age: Int, address: String): Person =
    if (age < 0 || age > 120) throw new RuntimeException("age is invalid")
    else                      new Person(name, age, address)

}

// Usage example:

val jules = Person("Jules", 30, "Sydney, Australia")
```

<br />

Now, it's equivalent to the Java code.

.bold[Except that it's immutable] ü§©


üë®‚Äçüè´: But with this code, you're still fired!
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {

  // bad
  def apply(name: String, ...): Person =
    if (age < 0 || age > 120) throw new RuntimeException("age is invalid")
    else                      new Person(name, age, address)

}
```
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {

  // bad
  def apply(name: String, ...): Person =
    if (age < 0 || age > 120) throw new RuntimeException("age is invalid")
    else                      new Person(name, age, address)

  // better
  def apply2(name: String, ...): Option[Person] =
    if (age < 0 || age > 120) None
    else                      Some(new Person(name, age, address))

}
```
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {

  // bad
  def apply(name: String, ...): Person =
    if (age < 0 || age > 120) throw new RuntimeException("age is invalid")
    else                      new Person(name, age, address)

  // better
  def apply2(name: String, ...): Option[Person] =
    if (age < 0 || age > 120) None
    else                      Some(new Person(name, age, address))

  // Why not
  def apply3(name: String, ...): Either[RuntimeException, Person] =
    if (age < 0 || age > 120) Left(new RuntimeException("age is invalid"))
    else                      Right(new Person(name, age, address))

}
```
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {

  // bad
  def apply(name: String, ...): Person =
    if (age < 0 || age > 120) throw new RuntimeException("age is invalid")
    else                      new Person(name, age, address)

  // better
  def apply2(name: String, ...): Option[Person] =
    if (age < 0 || age > 120) None
    else                      Some(new Person(name, age, address))

  // Why not
  def apply3(name: String, ...): Either[RuntimeException, Person] =
    if (age < 0 || age > 120) Left(new RuntimeException("age is invalid"))
    else                      Right(new Person(name, age, address))

  // Even better
  case class InvalidPersonAge(invalidAge: Int) extends RuntimeException(s"age is invalid: $invalidAge")

  def apply4(name: String, ...): Either[InvalidPersonAge, Person] =
    if (age < 0 || age > 120) Left(InvalidPersonAge(age))
    else                      Right(new Person(name, age, address))

}
```
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {

  // Even better
  case class InvalidPersonAge(invalidAge: Int) extends RuntimeException(s"age is invalid: $invalidAge")

  def apply4(name: String, ...): Either[InvalidPersonAge, Person] =
    if (age < 0 || age > 120) Left(InvalidPersonAge(age))
    else                      Right(new Person(name, age, address))

}
```
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {

  // Even better
  case class InvalidPersonAge(invalidAge: Int) extends RuntimeException(s"age is invalid: $invalidAge")

  def apply4(name: String, ...): Either[InvalidPersonAge, Person] =
    if (age < 0 || age > 120) Left(InvalidPersonAge(age))
    else                      Right(new Person(name, age, address))

  // Holly Graal üèÜ (PCE == PersonCreationException)
  sealed trait `PCE`(message: String) extends RuntimeException(message)
  case class InvalidPersonAge(invalidAge: Int)  extends PCE(s"age is invalid: $invalidAge")
  case class TooDumbNameException(name: String) extends PCE(s"choosed name is too dumb: $name")
  ...

  def applyüèÜ(name: String, ...): Either[`PCE`, Person] =
    if (age < 0 || age > 120)        Left(InvalidPersonAge(age))
    else if (name == "Harry Potter") Left(TooDumbNameException(name))
    ...
    else                             Right(new Person(name, age, address))

}
```
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {
  // Holly Graal üèÜ (PCE == PersonCreationException)
  sealed trait `PCE`(message: String) extends RuntimeException(message)
  case class InvalidPersonAge(invalidAge: Int)  extends PCE(s"age is invalid: $invalidAge")
  case class TooDumbNameException(name: String) extends PCE(s"choosed name is too dumb: $name")
  ...

  def applyüèÜ(name: String, ...): Either[`PCE`, Person] =
    if (age < 0 || age > 120)        Left(InvalidPersonAge(age))
    else if (name == "Harry Potter") Left(TooDumbNameException(name))
    ...
    else                             Right(new Person(name, age, address))
}
```
---
# Impure FP

```tut:nofail:silent
case class Person(name: String, age: Int, address: String)

object Person {
  // Holly Graal üèÜ (PCE == PersonCreationException)
  sealed trait `PCE`(message: String) extends RuntimeException(message)
  case class InvalidPersonAge(invalidAge: Int)  extends PCE(s"age is invalid: $invalidAge")
  case class TooDumbNameException(name: String) extends PCE(s"choosed name is too dumb: $name")
  ...

  def applyüèÜ(name: String, ...): Either[`PCE`, Person] =
    if (age < 0 || age > 120)        Left(InvalidPersonAge(age))
    else if (name == "Harry Potter") Left(TooDumbNameException(name))
    ...
    else                             Right(new Person(name, age, address))
}
```

What's the problem with throwing exceptions ?

  - Breaks linear execution path
  - Makes methods' signature lie
  - Impossible to know if a method is throwing without reading its code and all the code it calls! .bold[(Takes infinite time)]
  - it's an uncontrolled side effect
---
# Conclusion


FP helps me to write more delcarative code.

Pure FP help me to write more composable code.
---
class: center, middle

# Thanks!
Code and slides at `guizmaii/LilleFP` on GitHub

## Questions?


</div>
<script src="remark-latest.min.js">
</script>
<script>
  const slideshow = remark.create({
    ratio: "16:9", // 4:3

    highlightStyle: "github",
    highlightLines: true,
    highlightSpans: true,
  });
</script>
</body>
</html>
